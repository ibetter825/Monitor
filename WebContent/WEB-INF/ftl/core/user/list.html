<!DOCTYPE html>
<html>
<head>
<title>用户列表</title>
<#include "./../public/static/header.html"/>
</head>
<body class="easyui-layout" data-options="fit:true">
	<div data-options="region:'north', split:true, height:'auto', minHeight:110"
		style="border: none; padding: 0 10px; overflow: hidden;">
		<form id="searchForm" method="post">
			<ul class="prosearch">
				<li><i>项目名称</i> <a><input name="" type="text"
						class="scinput"></a></li>
				<li><i>项目编号</i><a><input name="" type="text"
						class="scinput"></a></li>
				<li><a><input name="" type="button" class="sure" value="查询"></a></li>
			</ul>
		</form>
		<div class="toolsline"></div>
		<div class="tools">
			<ul class="toolbar">
				<li class="click" onclick="form();"><span><img
						src="${(rc.contextPath)!}/images/t01.png"></span>添加</li>
				<li class="click"><span><img
						src="${(rc.contextPath)!}/images/t02.png"></span>修改</li>
				<li><span><img src="${(rc.contextPath)!}/images/t03.png"></span>删除</li>
				<li><span><img src="${(rc.contextPath)!}/images/t04.png"></span>统计</li>
			</ul>
		</div>
	</div>
	<!-- 内容区域 -->
	<div data-options="region:'center'"
		style="border: none; padding: 0 10px 10px 10px;">
		<table id="grid"></table>
	</div>
	
	<div id="formDialog" class="hide">
		<form id="form" method="post">
			<div class="formbody">
				<ul class="forminfo">
					<li><label>用户登录名</label><input id="userName" name="userName" type="text"
						class="dfinput easyui-validatebox" data-options="required:true"></li>
					<li><label>用户昵称</label><input id="nickName" name="nickName" type="text"
						class="dfinput easyui-validatebox" data-options="validType:'length[1,10]'"></li>
					<li><label>用户电话</label><input name="" type="text"
						class="dfinput"></li>
					<li><label>用户邮箱</label><input name="" type="text"
						class="dfinput easyui-validatebox" data-options="validType:'email'"></li>
				</ul>
			</div>
		</form>
	</div>
</body>
<#include "./../public/static/javascript.html"/>
<script>
	var $grid, $formDialog;
	$(function() {
		initGrid();
	});
	function initGrid() {
		$grid = $('#grid').datagrid({
			url : jui.uri + '/u/user/list',
			striped : true,
			autoRowHeight : false,
			fitColumns : true,
			rownumbers : true,
			height : 'auto',
			height: '100%',
			columns : [ [ {
				field : 'userNo',
				title : '用户编号',
				width : 100
			}, {
				field : 'userName',
				title : '用户登录名',
				width : 100
			}, {
				field : 'nickName',
				title : '用户昵称',
				width : 100
			} , {
				field : 'userPhone',
				title : '用户电话',
				width : 100,
				align : 'right'
			}, {
				field : 'userEmail',
				title : '用户邮箱',
				width : 100
			}] ],
			pagination : true,
			pageSize : 50,
			pageList : [ 50, 100, 200, 500 ]
		});
	}
	//表单
	function form(){
		if(!$formDialog){
			$('#formDialog').show();
			$formDialog = $('#formDialog').dialog({
				title: '表单',
				model: true,
				width: 380,
				height: 300,
				onClose: function(){
					$('#form').form('reset');
				},
				buttons:[{
					text:'保存',
					iconCls:'icon-save',
					handler:function(){
						if(!$('#form').form('validate'))
							return;
						var params = $('#form').serializeArray();
						//提交表单
						$.ajax({
							url: jui.uri + '/u/user/form',
							type: 'post',
							dataType: 'json',
							data: params,
							success: function(data){
								if(!data.success){
									var errors = data.data.errors;
									if(errors){
										for(var k in errors){
											var id = k;
											if(k.indexOf('.'))
												id = k.split('.')[1];
											var $id = $('#'+id);
											$id.tooltip({
												position: 'right',
												content: errors[k]
											});
											$id.tooltip('show');
										}
									}
								}else{
									$formDialog.dialog('close');
									$.messager.alert('信息',data.msg,'info');
								}
							},
							error: jQuery.ER
						});
					}
				},{
					text:'取消',
					iconCls:'icon-cancel',
					handler:function(){
						$formDialog.dialog('close');
					}
				}]
			});
		}else{
			$formDialog.dialog('open');
		}
	}
</script>
</html>
